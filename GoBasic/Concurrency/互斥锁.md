# ä¸€.äº’æ–¥é”ğŸ”’

* Goè¯­è¨€ä¸­å¤šä¸ªåç¨‹æ“ä½œä¸€ä¸ªå˜é‡æ—¶ä¼šå‡ºç°å†²çªçš„é—®é¢˜
* go run -race å¯ä»¥æŸ¥çœ‹ç«äº‰
* å¯ä»¥ä½¿ç”¨`sync.Mutex`å¯¹å†…å®¹åŠ é”
* äº’æ–¥é”çš„ä½¿ç”¨åœºæ™¯
  * å¤šä¸ªgoroutineè®¿é—®åŒä¸€ä¸ªå‡½æ•°(ä»£ç æ®µ)
  * è¿™ä¸ªå‡½æ•°æ“ä½œä¸€ä¸ªå…¨å±€å˜é‡
  * ä¸ºäº†ä¿è¯å…±äº«å˜é‡å®‰å…¨æ€§,å€¼åˆæ³•æ€§
* ä½¿ç”¨äº’æ–¥é”æ¨¡æ‹Ÿ`å”®ç¥¨çª—å£`

```go
package main

import (
   "fmt"
   "sync"
   "time"
   "math/rand"
)

var (
   //ç¥¨æ•°
   num = 100
   wg  sync.WaitGroup
   //äº’æ–¥é”
   mu sync.Mutex
)

func sellTicker(i int) {
   defer wg.Done()
   for {
      //åŠ é”,å¤šä¸ªgoroutineäº’æ–¥
      mu.Lock()
      if num >= 1 {
         fmt.Println("ç¬¬", i, "ä¸ªçª—å£å–äº†", num)
         num = num - 1
      }
      //è§£é”
      mu.Unlock()

      if num <= 0 {
         break
      }
      //æ·»åŠ ä¼‘çœ ,é˜²æ­¢ç»“æœå¯èƒ½å‡ºç°åœ¨ä¸€ä¸ªgoroutineä¸­
      time.Sleep(time.Duration(rand.Int63n(1000) * 1e6))
   }

}

func main() {
   //è®¾ç½®éšæœºæ•°ç§å­
   rand.Seed(time.Now().UnixNano())
   //è®¡ç®—å™¨çš„èµ·å§‹å€¼å’Œç¥¨æ•°ç›¸åŒ
   wg.Add(4)
   go sellTicker(1)
   go sellTicker(2)
   go sellTicker(3)
   go sellTicker(4)
   wg.Wait()

   fmt.Println("æ‰€æœ‰ç¥¨å–å®Œ")
}
```


